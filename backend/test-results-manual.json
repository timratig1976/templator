{"numFailedTestSuites":4,"numFailedTests":36,"numPassedTestSuites":3,"numPassedTests":30,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":7,"numTotalTests":66,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1753706858915,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["API Integration Tests","Health Check"],"duration":22,"failureDetails":[],"failureMessages":[],"fullName":"API Integration Tests Health Check should return healthy status","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return healthy status"},{"ancestorTitles":["API Integration Tests","Design API"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API Integration Tests Design API should return supported file types","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return supported file types"},{"ancestorTitles":["API Integration Tests","Design API"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"API Integration Tests Design API should handle design upload (mocked)","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should handle design upload (mocked)"},{"ancestorTitles":["API Integration Tests","Error Handling"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"API Integration Tests Error Handling should handle 404 for unknown endpoints","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should handle 404 for unknown endpoints"}],"endTime":1753706862048,"message":"","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/api.test.ts","startTime":1753706859354,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Design Controller - Simplified Tests","uploadDesign"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n    at hasbody (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:93:21)\n    at typeofrequest (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:127:8)\n    at multerMiddleware (/Users/timratig/CascadeProjects/templator/backend/node_modules/multer/lib/make-middleware.js:13:10)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:89:25)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Design Controller - Simplified Tests uploadDesign should successfully process a design upload","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully process a design upload"},{"ancestorTitles":["Design Controller - Simplified Tests","uploadDesign"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n    at hasbody (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:93:21)\n    at typeofrequest (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:127:8)\n    at multerMiddleware (/Users/timratig/CascadeProjects/templator/backend/node_modules/multer/lib/make-middleware.js:13:10)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:117:25)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Design Controller - Simplified Tests uploadDesign should handle missing file upload","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle missing file upload"},{"ancestorTitles":["Design Controller - Simplified Tests","uploadDesign"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n    at hasbody (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:93:21)\n    at typeofrequest (/Users/timratig/CascadeProjects/templator/backend/node_modules/type-is/index.js:127:8)\n    at multerMiddleware (/Users/timratig/CascadeProjects/templator/backend/node_modules/multer/lib/make-middleware.js:13:10)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:145:25)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Design Controller - Simplified Tests uploadDesign should handle OpenAI service errors","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle OpenAI service errors"},{"ancestorTitles":["Design Controller - Simplified Tests","refineHTML"],"duration":4,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"<div><h1>Welcome</h1><p>Test content</p></div>\"\u001b[39m, \u001b[32m\"Make it more modern with gradients and better typography\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"<div><h1>Welcome</h1><p>Test content</p></div>\"\u001b[39m, \u001b[32m\"Make it more modern with gradients and better typography\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:177:30)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller - Simplified Tests refineHTML should successfully refine HTML code","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully refine HTML code"},{"ancestorTitles":["Design Controller - Simplified Tests","refineHTML"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m400\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m400\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:207:30)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller - Simplified Tests refineHTML should handle missing HTML input","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle missing HTML input"},{"ancestorTitles":["Design Controller - Simplified Tests","refineHTML"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m500\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m500\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts:233:30)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller - Simplified Tests refineHTML should handle OpenAI service errors during refinement","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle OpenAI service errors during refinement"}],"endTime":1753706863177,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › uploadDesign › should successfully process a design upload\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 87 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 88 |\u001b[39m       \u001b[90m// Call the controller function\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 89 |\u001b[39m       \u001b[36mawait\u001b[39m uploadDesign(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 90 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 91 |\u001b[39m       \u001b[90m// Verify OpenAI service was called\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 92 |\u001b[39m       expect(mockConvertDesignToHTML)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat hasbody (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:93:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat typeofrequest (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:127:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat multerMiddleware (\u001b[22m\u001b[2mnode_modules/multer/lib/make-middleware.js\u001b[2m:13:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:89:25)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › uploadDesign › should handle missing file upload\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 115 |\u001b[39m       \u001b[36mconst\u001b[39m mockNext \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 116 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 117 |\u001b[39m       \u001b[36mawait\u001b[39m uploadDesign(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 118 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 119 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 120 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mjson)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat hasbody (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:93:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat typeofrequest (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:127:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat multerMiddleware (\u001b[22m\u001b[2mnode_modules/multer/lib/make-middleware.js\u001b[2m:13:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:117:25)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › uploadDesign › should handle OpenAI service errors\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'transfer-encoding')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 143 |\u001b[39m       \u001b[36mconst\u001b[39m mockNext \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 144 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 145 |\u001b[39m       \u001b[36mawait\u001b[39m uploadDesign(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 146 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 147 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m500\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 148 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mjson)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat hasbody (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:93:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat typeofrequest (\u001b[22m\u001b[2mnode_modules/type-is/index.js\u001b[2m:127:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat multerMiddleware (\u001b[22m\u001b[2mnode_modules/multer/lib/make-middleware.js\u001b[2m:13:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:145:25)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › refineHTML › should successfully refine HTML code\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"<div><h1>Welcome</h1><p>Test content</p></div>\"\u001b[39m, \u001b[32m\"Make it more modern with gradients and better typography\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 175 |\u001b[39m       \u001b[36mawait\u001b[39m refineHTML(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 176 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 177 |\u001b[39m       expect(mockRefineHTML)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 178 |\u001b[39m         \u001b[32m'<div><h1>Welcome</h1><p>Test content</p></div>'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 179 |\u001b[39m         \u001b[32m'Make it more modern with gradients and better typography'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 180 |\u001b[39m       )\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:177:30)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › refineHTML › should handle missing HTML input\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m400\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 205 |\u001b[39m       \u001b[36mawait\u001b[39m refineHTML(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 206 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 207 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 208 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mjson)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({\u001b[22m\n\u001b[2m     \u001b[90m 209 |\u001b[39m         success\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 210 |\u001b[39m         error\u001b[33m:\u001b[39m \u001b[32m'HTML code is required'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:207:30)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller - Simplified Tests › refineHTML › should handle OpenAI service errors during refinement\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m500\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 231 |\u001b[39m       \u001b[36mawait\u001b[39m refineHTML(mockReq\u001b[33m,\u001b[39m mockRes\u001b[33m,\u001b[39m mockNext)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 232 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 233 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m500\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 234 |\u001b[39m       expect(mockRes\u001b[33m.\u001b[39mjson)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({\u001b[22m\n\u001b[2m     \u001b[90m 235 |\u001b[39m         success\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 236 |\u001b[39m         error\u001b[33m:\u001b[39m \u001b[32m'Failed to refine HTML'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.simple.test.ts\u001b[39m\u001b[0m\u001b[2m:233:30)\u001b[22m\u001b[2m\u001b[22m\n","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.simple.test.ts","startTime":1753706859354,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":28,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite HTML Input Processing","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"HTML Input Processing"},{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite Complex Layout Splitting","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"Complex Layout Splitting"},{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite Section Processing and Module Generation","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"Section Processing and Module Generation"},{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite Module Validation","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"Module Validation"},{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite Schema Compatibility Check","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"Schema Compatibility Check"},{"ancestorTitles":["Streamlined Comprehensive E2E Test Suite"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Streamlined Comprehensive E2E Test Suite End-to-End Workflow Performance","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"End-to-End Workflow Performance"}],"endTime":1753706863341,"message":"","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/comprehensive-e2e-streamlined.test.ts","startTime":1753706859354,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":16,"failureDetails":[{"statusCode":500,"code":"INTERNAL_ERROR","details":"OpenAI client not available in test environment"}],"failureMessages":["Error: Failed to convert design to HTML\n    at createError (/Users/timratig/CascadeProjects/templator/backend/src/middleware/errorHandler.ts:52:17)\n    at OpenAIService.convertDesignToHTML (/Users/timratig/CascadeProjects/templator/backend/src/services/openaiService.ts:513:24)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:109:22)"],"fullName":"OpenAI Service Tests convertDesignToHTML should successfully convert design to HTML with valid AI response","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully convert design to HTML with valid AI response"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":1,"failureDetails":[{"statusCode":500,"code":"INTERNAL_ERROR","details":"OpenAI client not available in test environment"}],"failureMessages":["Error: Failed to convert design to HTML\n    at createError (/Users/timratig/CascadeProjects/templator/backend/src/middleware/errorHandler.ts:52:17)\n    at OpenAIService.convertDesignToHTML (/Users/timratig/CascadeProjects/templator/backend/src/services/openaiService.ts:513:24)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:164:22)"],"fullName":"OpenAI Service Tests convertDesignToHTML should handle AI response without JSON markdown formatting","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle AI response without JSON markdown formatting"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":12,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:181:7)\u001b[22m","pass":false},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:181:7)\u001b[22m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:181:7)\u001b[22m\n    at Object.toThrow (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:183:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests convertDesignToHTML should throw error when OpenAI returns no content","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should throw error when OpenAI returns no content"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":2,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Invalid response format from AI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:197:7)\u001b[22m","pass":false},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Invalid response format from AI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:197:7)\u001b[22m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Invalid response format from AI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:197:7)\u001b[22m\n    at Object.toThrow (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:199:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests convertDesignToHTML should throw error when AI response has invalid JSON format","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should throw error when AI response has invalid JSON format"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Failed to parse AI response\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:213:7)\u001b[22m","pass":false},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Failed to parse AI response\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:213:7)\u001b[22m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Failed to parse AI response\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:213:7)\u001b[22m\n    at Object.toThrow (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:215:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests convertDesignToHTML should throw error when JSON parsing fails","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should throw error when JSON parsing fails"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"OpenAI API quota exceeded\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:224:7)\u001b[22m","pass":false},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"OpenAI API quota exceeded\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:224:7)\u001b[22m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"OpenAI API quota exceeded\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:224:7)\u001b[22m\n    at Object.toThrow (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:226:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests convertDesignToHTML should handle OpenAI API quota exceeded error","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle OpenAI API quota exceeded error"},{"ancestorTitles":["OpenAI Service Tests","convertDesignToHTML"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"OpenAI Service Tests convertDesignToHTML should handle general OpenAI API errors","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle general OpenAI API errors"},{"ancestorTitles":["OpenAI Service Tests","refineHTML"],"duration":3,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"gradient\"\u001b[39m\nReceived string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"gradient\"\u001b[39m\nReceived string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:256:22)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"OpenAI Service Tests refineHTML should successfully refine HTML with requirements","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully refine HTML with requirements"},{"ancestorTitles":["OpenAI Service Tests","refineHTML"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"max-w-4xl\"\u001b[39m\nReceived string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"max-w-4xl\"\u001b[39m\nReceived string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:285:22)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"OpenAI Service Tests refineHTML should refine HTML without specific requirements","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should refine HTML without specific requirements"},{"ancestorTitles":["OpenAI Service Tests","refineHTML"],"duration":1,"failureDetails":[{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n    at expect (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:300:13)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests refineHTML should throw error when OpenAI returns no content for refinement","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should throw error when OpenAI returns no content for refinement"},{"ancestorTitles":["OpenAI Service Tests","refineHTML"],"duration":2,"failureDetails":[{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n    at expect (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:309:13)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests refineHTML should handle OpenAI API errors during refinement","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle OpenAI API errors during refinement"},{"ancestorTitles":["OpenAI Service Tests","Error Handling"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"OpenAI Service Tests Error Handling should handle network errors gracefully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle network errors gracefully"},{"ancestorTitles":["OpenAI Service Tests","Error Handling"],"duration":1,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:332:7)\u001b[22m","pass":false},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:332:7)\u001b[22m"}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\nReceived message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n      \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:332:7)\u001b[22m\n    at Object.toThrow (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts:334:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"OpenAI Service Tests Error Handling should handle malformed API responses","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle malformed API responses"}],"endTime":1753706863525,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should successfully convert design to HTML with valid AI response\u001b[39m\u001b[22m\n\n    Failed to convert design to HTML\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createError (\u001b[22m\u001b[2msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22m\u001b[2msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:109:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should handle AI response without JSON markdown formatting\u001b[39m\u001b[22m\n\n    Failed to convert design to HTML\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createError (\u001b[22m\u001b[2msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22m\u001b[2msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:164:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should throw error when OpenAI returns no content\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\n    Received message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n        \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n         \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n         \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n         \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n          \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n          \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:181:7)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 181 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mconvertDesignToHTML(mockImageBase64\u001b[33m,\u001b[39m mockFileName))\u001b[22m\n\u001b[2m     \u001b[90m 182 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 183 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'No response from OpenAI'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 184 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 185 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 186 |\u001b[39m     it(\u001b[32m'should throw error when AI response has invalid JSON format'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:183:10)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should throw error when AI response has invalid JSON format\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Invalid response format from AI\"\u001b[39m\n    Received message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n        \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n         \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n         \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n         \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n          \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n          \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:197:7)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 197 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mconvertDesignToHTML(mockImageBase64\u001b[33m,\u001b[39m mockFileName))\u001b[22m\n\u001b[2m     \u001b[90m 198 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 199 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'Invalid response format from AI'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 200 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 201 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 202 |\u001b[39m     it(\u001b[32m'should throw error when JSON parsing fails'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:199:10)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should throw error when JSON parsing fails\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Failed to parse AI response\"\u001b[39m\n    Received message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n        \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n         \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n         \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n         \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n          \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n          \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:213:7)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 213 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mconvertDesignToHTML(mockImageBase64\u001b[33m,\u001b[39m mockFileName))\u001b[22m\n\u001b[2m     \u001b[90m 214 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 215 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'Failed to parse AI response'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 216 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 217 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 218 |\u001b[39m     it(\u001b[32m'should handle OpenAI API quota exceeded error'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:215:10)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › convertDesignToHTML › should handle OpenAI API quota exceeded error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"OpenAI API quota exceeded\"\u001b[39m\n    Received message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n        \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n         \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n         \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n         \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n          \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n          \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:224:7)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 224 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mconvertDesignToHTML(mockImageBase64\u001b[33m,\u001b[39m mockFileName))\u001b[22m\n\u001b[2m     \u001b[90m 225 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 226 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'OpenAI API quota exceeded'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 227 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 228 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 229 |\u001b[39m     it(\u001b[32m'should handle general OpenAI API errors'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:226:10)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › refineHTML › should successfully refine HTML with requirements\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\n    Expected substring: \u001b[32m\"gradient\"\u001b[39m\n    Received string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 254 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m openaiService\u001b[33m.\u001b[39mrefineHTML(mockHTML\u001b[33m,\u001b[39m mockRequirements)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 255 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 256 |\u001b[39m       expect(result)\u001b[33m.\u001b[39mtoContain(\u001b[32m'gradient'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 257 |\u001b[39m       expect(result)\u001b[33m.\u001b[39mtoContain(\u001b[32m'text-4xl'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 258 |\u001b[39m       expect(result)\u001b[33m.\u001b[39mtoContain(\u001b[32m'mx-auto'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 259 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:256:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › refineHTML › should refine HTML without specific requirements\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\n    Expected substring: \u001b[32m\"max-w-4xl\"\u001b[39m\n    Received string:    \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 283 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m openaiService\u001b[33m.\u001b[39mrefineHTML(mockHTML)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 284 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 285 |\u001b[39m       expect(result)\u001b[33m.\u001b[39mtoContain(\u001b[32m'max-w-4xl'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 286 |\u001b[39m       expect(result)\u001b[33m.\u001b[39mtoContain(\u001b[32m'text-3xl'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 287 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 288 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:285:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › refineHTML › should throw error when OpenAI returns no content for refinement\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\n    Received promise resolved instead of rejected\n    Resolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 298 |\u001b[39m       mockChatCompletions\u001b[33m.\u001b[39mcreate\u001b[33m.\u001b[39mmockResolvedValue(mockAIResponse \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 299 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 300 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mrefineHTML(mockHTML\u001b[33m,\u001b[39m mockRequirements))\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 301 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m     \u001b[90m 302 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'No response from OpenAI'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 303 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:300:13)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › refineHTML › should handle OpenAI API errors during refinement\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\n    Received promise resolved instead of rejected\n    Resolved to value: \u001b[31m\"<div class=\\\"container\\\"><h1>Title</h1><p>Content</p></div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 307 |\u001b[39m       mockChatCompletions\u001b[33m.\u001b[39mcreate\u001b[33m.\u001b[39mmockRejectedValue(apiError)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 308 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 309 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mrefineHTML(mockHTML\u001b[33m,\u001b[39m mockRequirements))\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 310 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m     \u001b[90m 311 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'Failed to convert design to HTML'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 312 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:309:13)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mOpenAI Service Tests › Error Handling › should handle malformed API responses\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"No response from OpenAI\"\u001b[39m\n    Received message:   \u001b[31m\"Failed to convert design to HTML\"\u001b[39m\n\n        \u001b[0m \u001b[90m 50 |\u001b[39m   suggestion\u001b[33m?\u001b[39m\u001b[33m:\u001b[39m string\n         \u001b[90m 51 |\u001b[39m )\u001b[33m:\u001b[39m \u001b[33mAppError\u001b[39m \u001b[33m=>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m   \u001b[36mconst\u001b[39m error \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(message) \u001b[36mas\u001b[39m \u001b[33mAppError\u001b[39m\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 53 |\u001b[39m   error\u001b[33m.\u001b[39mstatusCode \u001b[33m=\u001b[39m statusCode\u001b[33m;\u001b[39m\n         \u001b[90m 54 |\u001b[39m   error\u001b[33m.\u001b[39mcode \u001b[33m=\u001b[39m code\u001b[33m;\u001b[39m\n         \u001b[90m 55 |\u001b[39m   error\u001b[33m.\u001b[39mdetails \u001b[33m=\u001b[39m details\u001b[33m;\u001b[39m\u001b[0m\n\n          \u001b[2mat createError (\u001b[22msrc/middleware/errorHandler.ts\u001b[2m:52:17)\u001b[22m\n          \u001b[2mat OpenAIService.convertDesignToHTML (\u001b[22msrc/services/openaiService.ts\u001b[2m:513:24)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22msrc/__tests__/openaiService.test.ts\u001b[2m:332:7)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 332 |\u001b[39m       \u001b[36mawait\u001b[39m expect(openaiService\u001b[33m.\u001b[39mconvertDesignToHTML(\u001b[32m'test-image'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'test.png'\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m 333 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 334 |\u001b[39m         \u001b[33m.\u001b[39mtoThrow(\u001b[32m'No response from OpenAI'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 335 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 336 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 337 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/jest-circus/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/openaiService.test.ts\u001b[39m\u001b[0m\u001b[2m:334:10)\u001b[22m\u001b[2m\u001b[22m\n","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/openaiService.test.ts","startTime":1753706859354,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["End-to-End Test Scenarios","Complete Design-to-HubSpot Workflow"],"duration":21,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContainEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\nExpected value: \u001b[32mObjectContaining {\"extension\": \"png\", \"mimeType\": \"image/png\"}\u001b[39m\nReceived array: \u001b[31m[{\"description\": \"JPEG images\", \"extensions\": [\".jpg\", \".jpeg\"], \"type\": \"image/jpeg\"}, {\"description\": \"PNG images\", \"extensions\": [\".png\"], \"type\": \"image/png\"}, {\"description\": \"GIF images\", \"extensions\": [\".gif\"], \"type\": \"image/gif\"}, {\"description\": \"WebP images\", \"extensions\": [\".webp\"], \"type\": \"image/webp\"}]\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContainEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\nExpected value: \u001b[32mObjectContaining {\"extension\": \"png\", \"mimeType\": \"image/png\"}\u001b[39m\nReceived array: \u001b[31m[{\"description\": \"JPEG images\", \"extensions\": [\".jpg\", \".jpeg\"], \"type\": \"image/jpeg\"}, {\"description\": \"PNG images\", \"extensions\": [\".png\"], \"type\": \"image/png\"}, {\"description\": \"GIF images\", \"extensions\": [\".gif\"], \"type\": \"image/gif\"}, {\"description\": \"WebP images\", \"extensions\": [\".webp\"], \"type\": \"image/webp\"}]\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:59:63)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios Complete Design-to-HubSpot Workflow should handle the complete workflow: upload design → generate HTML → refine code","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should handle the complete workflow: upload design → generate HTML → refine code"},{"ancestorTitles":["End-to-End Test Scenarios","Complete Design-to-HubSpot Workflow"],"duration":12,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:121:12)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"End-to-End Test Scenarios Complete Design-to-HubSpot Workflow should handle multiple file uploads in sequence","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle multiple file uploads in sequence"},{"ancestorTitles":["End-to-End Test Scenarios","Complete Design-to-HubSpot Workflow"],"duration":4,"failureDetails":[{"matcherResult":{"expected":false,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:144:44)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios Complete Design-to-HubSpot Workflow should handle error scenarios gracefully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle error scenarios gracefully"},{"ancestorTitles":["End-to-End Test Scenarios","API Performance and Load Testing"],"duration":12,"failureDetails":[{"matcherResult":{"actual":500,"expected":200,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m200\u001b[39m\nReceived: \u001b[31m500\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m200\u001b[39m\nReceived: \u001b[31m500\u001b[39m\n    at /Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:180:33\n    at Array.forEach (<anonymous>)\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:179:17)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios API Performance and Load Testing should handle concurrent upload requests","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle concurrent upload requests"},{"ancestorTitles":["End-to-End Test Scenarios","API Performance and Load Testing"],"duration":4,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:193:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"End-to-End Test Scenarios API Performance and Load Testing should maintain response time under load","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should maintain response time under load"},{"ancestorTitles":["End-to-End Test Scenarios","Data Validation and Security"],"duration":62,"failureDetails":[{}],"failureMessages":["Error: expected 413 \"Payload Too Large\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:210:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"End-to-End Test Scenarios Data Validation and Security should validate file size limits","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should validate file size limits"},{"ancestorTitles":["End-to-End Test Scenarios","Data Validation and Security"],"duration":15,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mnot\u001b[2m.\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: not \u001b[32m\"<script>\"\u001b[39m\nReceived string:        \u001b[31m\"\u001b[7m<script>\u001b[27malert(\\\"xss\\\")</script><div>Content</div>\"\u001b[39m","pass":true}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mnot\u001b[2m.\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: not \u001b[32m\"<script>\"\u001b[39m\nReceived string:        \u001b[31m\"\u001b[7m<script>\u001b[27malert(\\\"xss\\\")</script><div>Content</div>\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:228:50)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios Data Validation and Security should sanitize and validate input data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should sanitize and validate input data"},{"ancestorTitles":["End-to-End Test Scenarios","Data Validation and Security"],"duration":6,"failureDetails":[{"matcherResult":{"expected":false,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:239:37)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios Data Validation and Security should handle malformed requests","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle malformed requests"},{"ancestorTitles":["End-to-End Test Scenarios","Integration with External Services"],"duration":3,"failureDetails":[{"matcherResult":{"expected":false,"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:256:37)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"End-to-End Test Scenarios Integration with External Services should handle OpenAI API failures gracefully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle OpenAI API failures gracefully"},{"ancestorTitles":["End-to-End Test Scenarios","Real-world Usage Scenarios"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:269:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"End-to-End Test Scenarios Real-world Usage Scenarios should handle typical landing page design conversion","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle typical landing page design conversion"},{"ancestorTitles":["End-to-End Test Scenarios","Real-world Usage Scenarios"],"duration":2,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts:299:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"End-to-End Test Scenarios Real-world Usage Scenarios should generate HubSpot-compatible field mappings","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should generate HubSpot-compatible field mappings"}],"endTime":1753706864304,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Complete Design-to-HubSpot Workflow › should handle the complete workflow: upload design → generate HTML → refine code\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContainEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    Expected value: \u001b[32mObjectContaining {\"extension\": \"png\", \"mimeType\": \"image/png\"}\u001b[39m\n    Received array: \u001b[31m[{\"description\": \"JPEG images\", \"extensions\": [\".jpg\", \".jpeg\"], \"type\": \"image/jpeg\"}, {\"description\": \"PNG images\", \"extensions\": [\".png\"], \"type\": \"image/png\"}, {\"description\": \"GIF images\", \"extensions\": [\".gif\"], \"type\": \"image/gif\"}, {\"description\": \"WebP images\", \"extensions\": [\".webp\"], \"type\": \"image/webp\"}]\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 57 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m       expect(supportedTypesResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 59 |\u001b[39m       expect(supportedTypesResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39msupportedTypes)\u001b[33m.\u001b[39mtoContainEqual(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 60 |\u001b[39m         expect\u001b[33m.\u001b[39mobjectContaining({ extension\u001b[33m:\u001b[39m \u001b[32m'png'\u001b[39m\u001b[33m,\u001b[39m mimeType\u001b[33m:\u001b[39m \u001b[32m'image/png'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 61 |\u001b[39m       )\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 62 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:59:63)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Complete Design-to-HubSpot Workflow › should handle multiple file uploads in sequence\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 119 |\u001b[39m           \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 120 |\u001b[39m           \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m image\u001b[33m.\u001b[39mbuffer\u001b[33m,\u001b[39m image\u001b[33m.\u001b[39mname)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 121 |\u001b[39m           \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 122 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 123 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 124 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mfileName)\u001b[33m.\u001b[39mtoBe(image\u001b[33m.\u001b[39mname)\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:121:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Complete Design-to-HubSpot Workflow › should handle error scenarios gracefully\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mundefined\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 142 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 143 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 144 |\u001b[39m       expect(invalidResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 145 |\u001b[39m       expect(invalidResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoContain(\u001b[32m'Invalid file type'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 146 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 147 |\u001b[39m       \u001b[90m// Test 2: Missing file\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:144:44)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › API Performance and Load Testing › should handle concurrent upload requests\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m200\u001b[39m\n    Received: \u001b[31m500\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 178 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 179 |\u001b[39m       responses\u001b[33m.\u001b[39mforEach((response\u001b[33m:\u001b[39m any\u001b[33m,\u001b[39m index\u001b[33m:\u001b[39m number) \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 180 |\u001b[39m         expect(response\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 181 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 182 |\u001b[39m         expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mfileName)\u001b[33m.\u001b[39mtoBe(\u001b[32m`concurrent-design-${index}.png`\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 183 |\u001b[39m       })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:180:33\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at Array.forEach (<anonymous>)\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:179:17)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › API Performance and Load Testing › should maintain response time under load\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 191 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 192 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m mockImage\u001b[33m,\u001b[39m \u001b[32m'performance-test.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 193 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 194 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 195 |\u001b[39m       \u001b[36mconst\u001b[39m responseTime \u001b[33m=\u001b[39m \u001b[33mDate\u001b[39m\u001b[33m.\u001b[39mnow() \u001b[33m-\u001b[39m startTime\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 196 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:193:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Data Validation and Security › should validate file size limits\u001b[39m\u001b[22m\n\n    expected 413 \"Payload Too Large\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 208 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 209 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m largeFile\u001b[33m,\u001b[39m \u001b[32m'large-file.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 210 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m413\u001b[39m)\u001b[33m;\u001b[39m \u001b[90m// Payload too large\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 211 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 212 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 213 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:210:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Data Validation and Security › should sanitize and validate input data\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mnot\u001b[2m.\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\n    Expected substring: not \u001b[32m\"<script>\"\u001b[39m\n    Received string:        \u001b[31m\"\u001b[7m<script>\u001b[27malert(\\\"xss\\\")</script><div>Content</div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 226 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 227 |\u001b[39m       \u001b[90m// The refined HTML should not contain the script tag\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 228 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mrefinedHTML)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoContain(\u001b[32m'<script>'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 229 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 230 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 231 |\u001b[39m     it(\u001b[32m'should handle malformed requests'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:228:50)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Data Validation and Security › should handle malformed requests\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mundefined\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 237 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 238 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 239 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 240 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 241 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 242 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:239:37)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Integration with External Services › should handle OpenAI API failures gracefully\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mundefined\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 254 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m500\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 255 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 256 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 257 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoContain(\u001b[32m'Failed to convert design to HTML'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 258 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 259 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:256:37)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Real-world Usage Scenarios › should handle typical landing page design conversion\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 267 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 268 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m landingPageImage\u001b[33m,\u001b[39m \u001b[32m'landing-page-mockup.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 269 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 270 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 271 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 272 |\u001b[39m       \u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:269:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mEnd-to-End Test Scenarios › Real-world Usage Scenarios › should generate HubSpot-compatible field mappings\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 297 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 298 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m mockImage\u001b[33m,\u001b[39m \u001b[32m'hubspot-template.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 299 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 300 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 301 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 302 |\u001b[39m       \u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/e2e.test.ts\u001b[39m\u001b[0m\u001b[2m:299:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/e2e.test.ts","startTime":1753706859354,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Design Controller API Tests","GET /api/design/supported-types"],"duration":42,"failureDetails":[{"matcherResult":{"actual":{"success":true,"data":{"supportedTypes":[{"type":"image/jpeg","extensions":[".jpg",".jpeg"],"description":"JPEG images"},{"type":"image/png","extensions":[".png"],"description":"PNG images"},{"type":"image/gif","extensions":[".gif"],"description":"GIF images"},{"type":"image/webp","extensions":[".webp"],"description":"WebP images"}],"maxFileSize":"10MB","recommendations":["Use high-resolution images for better AI analysis","Ensure design elements are clearly visible","PNG format recommended for designs with text","JPEG format recommended for photographs"]}},"expected":{"success":true,"data":{"supportedTypes":[{"extension":"png","mimeType":"image/png","description":"PNG images"},{"extension":"jpg","mimeType":"image/jpeg","description":"JPEG images"},{"extension":"jpeg","mimeType":"image/jpeg","description":"JPEG images"},{"extension":"gif","mimeType":"image/gif","description":"GIF images"},{"extension":"webp","mimeType":"image/webp","description":"WebP images"}],"maxFileSize":"10MB","notes":["PDF support coming soon","For best results, use high-resolution images","Ensure text and elements are clearly visible"]},"message":"Supported file types retrieved successfully"},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 19\u001b[39m\n\u001b[31m+ Received  + 23\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"data\": Object {\u001b[22m\n\u001b[2m      \"maxFileSize\": \"10MB\",\u001b[22m\n\u001b[32m-     \"notes\": Array [\u001b[39m\n\u001b[32m-       \"PDF support coming soon\",\u001b[39m\n\u001b[32m-       \"For best results, use high-resolution images\",\u001b[39m\n\u001b[32m-       \"Ensure text and elements are clearly visible\",\u001b[39m\n\u001b[31m+     \"recommendations\": Array [\u001b[39m\n\u001b[31m+       \"Use high-resolution images for better AI analysis\",\u001b[39m\n\u001b[31m+       \"Ensure design elements are clearly visible\",\u001b[39m\n\u001b[31m+       \"PNG format recommended for designs with text\",\u001b[39m\n\u001b[31m+       \"JPEG format recommended for photographs\",\u001b[39m\n\u001b[2m      ],\u001b[22m\n\u001b[2m      \"supportedTypes\": Array [\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[32m-         \"description\": \"PNG images\",\u001b[39m\n\u001b[32m-         \"extension\": \"png\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/png\",\u001b[39m\n\u001b[32m-       },\u001b[39m\n\u001b[32m-       Object {\u001b[39m\n\u001b[2m          \"description\": \"JPEG images\",\u001b[22m\n\u001b[32m-         \"extension\": \"jpg\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".jpg\",\u001b[39m\n\u001b[31m+           \".jpeg\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/jpeg\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[32m-         \"description\": \"JPEG images\",\u001b[39m\n\u001b[32m-         \"extension\": \"jpeg\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n\u001b[31m+         \"description\": \"PNG images\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".png\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/png\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[2m          \"description\": \"GIF images\",\u001b[22m\n\u001b[32m-         \"extension\": \"gif\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/gif\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".gif\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/gif\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[2m          \"description\": \"WebP images\",\u001b[22m\n\u001b[32m-         \"extension\": \"webp\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/webp\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".webp\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/webp\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m      ],\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[32m-   \"message\": \"Supported file types retrieved successfully\",\u001b[39m\n\u001b[2m    \"success\": true,\u001b[22m\n\u001b[2m  }\u001b[22m","name":"toEqual","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 19\u001b[39m\n\u001b[31m+ Received  + 23\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"data\": Object {\u001b[22m\n\u001b[2m      \"maxFileSize\": \"10MB\",\u001b[22m\n\u001b[32m-     \"notes\": Array [\u001b[39m\n\u001b[32m-       \"PDF support coming soon\",\u001b[39m\n\u001b[32m-       \"For best results, use high-resolution images\",\u001b[39m\n\u001b[32m-       \"Ensure text and elements are clearly visible\",\u001b[39m\n\u001b[31m+     \"recommendations\": Array [\u001b[39m\n\u001b[31m+       \"Use high-resolution images for better AI analysis\",\u001b[39m\n\u001b[31m+       \"Ensure design elements are clearly visible\",\u001b[39m\n\u001b[31m+       \"PNG format recommended for designs with text\",\u001b[39m\n\u001b[31m+       \"JPEG format recommended for photographs\",\u001b[39m\n\u001b[2m      ],\u001b[22m\n\u001b[2m      \"supportedTypes\": Array [\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[32m-         \"description\": \"PNG images\",\u001b[39m\n\u001b[32m-         \"extension\": \"png\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/png\",\u001b[39m\n\u001b[32m-       },\u001b[39m\n\u001b[32m-       Object {\u001b[39m\n\u001b[2m          \"description\": \"JPEG images\",\u001b[22m\n\u001b[32m-         \"extension\": \"jpg\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".jpg\",\u001b[39m\n\u001b[31m+           \".jpeg\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/jpeg\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[32m-         \"description\": \"JPEG images\",\u001b[39m\n\u001b[32m-         \"extension\": \"jpeg\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n\u001b[31m+         \"description\": \"PNG images\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".png\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/png\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[2m          \"description\": \"GIF images\",\u001b[22m\n\u001b[32m-         \"extension\": \"gif\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/gif\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".gif\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/gif\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m        Object {\u001b[22m\n\u001b[2m          \"description\": \"WebP images\",\u001b[22m\n\u001b[32m-         \"extension\": \"webp\",\u001b[39m\n\u001b[32m-         \"mimeType\": \"image/webp\",\u001b[39m\n\u001b[31m+         \"extensions\": Array [\u001b[39m\n\u001b[31m+           \".webp\",\u001b[39m\n\u001b[31m+         ],\u001b[39m\n\u001b[31m+         \"type\": \"image/webp\",\u001b[39m\n\u001b[2m        },\u001b[22m\n\u001b[2m      ],\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[32m-   \"message\": \"Supported file types retrieved successfully\",\u001b[39m\n\u001b[2m    \"success\": true,\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:89:29)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller API Tests GET /api/design/supported-types should return supported file types","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return supported file types"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":14,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:122:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Design Controller API Tests POST /api/design/upload should successfully upload and convert a PNG image","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully upload and convert a PNG image"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":6,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:135:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Design Controller API Tests POST /api/design/upload should successfully upload and convert a JPG image","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should successfully upload and convert a JPG image"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/upload should reject unsupported file types","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject unsupported file types"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":36,"failureDetails":[{}],"failureMessages":["Error: expected 413 \"Payload Too Large\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:157:10)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Design Controller API Tests POST /api/design/upload should reject files that are too large","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should reject files that are too large"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/upload should handle missing file upload","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle missing file upload"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":6,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"OpenAI API error\"\u001b[39m\nReceived string:    \u001b[31m\"Input buffer contains unsupported image format\"\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"OpenAI API error\"\u001b[39m\nReceived string:    \u001b[31m\"Input buffer contains unsupported image format\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:182:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller API Tests POST /api/design/upload should handle OpenAI service errors","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should handle OpenAI service errors"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/upload"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/upload should reject PDF files with appropriate message","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject PDF files with appropriate message"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/refine"],"duration":18,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m, \u001b[22m\u001b[32mvalue\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"refinedHTML\"\u001b[39m\n\nExpected value: \u001b[32m\"<div class=\\\"\u001b[7mbg-gradient-to-r from-blue-500 to-purple-600\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m5\u001b[27mxl font-bold text-\u001b[7mwhite\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mblue-1\u001b[27m00 mt-4\\\">This is \u001b[7ma \u001b[27mrefined \u001b[7mdesign with better styling\u001b[27m.</p></div>\"\u001b[39m\nReceived value: \u001b[31m\"<div class=\\\"\u001b[7mrefined bg-white\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m4\u001b[27mxl font-bold text-\u001b[7mgray-900\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mgray-6\u001b[27m00 mt-4\\\">This is refined \u001b[7mHTML\u001b[27m.</p></div>\"\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m, \u001b[22m\u001b[32mvalue\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"refinedHTML\"\u001b[39m\n\nExpected value: \u001b[32m\"<div class=\\\"\u001b[7mbg-gradient-to-r from-blue-500 to-purple-600\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m5\u001b[27mxl font-bold text-\u001b[7mwhite\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mblue-1\u001b[27m00 mt-4\\\">This is \u001b[7ma \u001b[27mrefined \u001b[7mdesign with better styling\u001b[27m.</p></div>\"\u001b[39m\nReceived value: \u001b[31m\"<div class=\\\"\u001b[7mrefined bg-white\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m4\u001b[27mxl font-bold text-\u001b[7mgray-900\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mgray-6\u001b[27m00 mt-4\\\">This is refined \u001b[7mHTML\u001b[27m.</p></div>\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:214:34)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller API Tests POST /api/design/refine should successfully refine HTML code","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"should successfully refine HTML code"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/refine"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/refine should refine HTML without specific requirements","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should refine HTML without specific requirements"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/refine"],"duration":8,"failureDetails":[{"matcherResult":{"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"HTML code is required\"\u001b[39m\nReceived string:    \u001b[31m\"Invalid request data\"\u001b[39m","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\nExpected substring: \u001b[32m\"HTML code is required\"\u001b[39m\nReceived string:    \u001b[31m\"Invalid request data\"\u001b[39m\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:238:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Design Controller API Tests POST /api/design/refine should reject empty HTML input","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should reject empty HTML input"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/refine"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/refine should reject missing HTML input","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should reject missing HTML input"},{"ancestorTitles":["Design Controller API Tests","POST /api/design/refine"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Design Controller API Tests POST /api/design/refine should handle OpenAI service errors during refinement","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle OpenAI service errors during refinement"},{"ancestorTitles":["Integration Tests"],"duration":4,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 500 \"Internal Server Error\"\n    at Object.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts:280:8)\n    at Promise.then.completed (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/timratig/CascadeProjects/templator/backend/node_modules/jest-runner/build/testWorker.js:106:12)\n----\n    at Test._assertStatus (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:309:14)\n    at /Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:365:13\n    at Test._assertFunction (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:342:13)\n    at Test.assert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:195:23)\n    at localAssert (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:138:14)\n    at Server.<anonymous> (/Users/timratig/CascadeProjects/templator/backend/node_modules/supertest/lib/test.js:152:11)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Integration Tests should handle complete workflow: upload -> refine","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle complete workflow: upload -> refine"}],"endTime":1753706864717,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › GET /api/design/supported-types › should return supported file types\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 19\u001b[39m\n    \u001b[31m+ Received  + 23\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"data\": Object {\u001b[22m\n    \u001b[2m      \"maxFileSize\": \"10MB\",\u001b[22m\n    \u001b[32m-     \"notes\": Array [\u001b[39m\n    \u001b[32m-       \"PDF support coming soon\",\u001b[39m\n    \u001b[32m-       \"For best results, use high-resolution images\",\u001b[39m\n    \u001b[32m-       \"Ensure text and elements are clearly visible\",\u001b[39m\n    \u001b[31m+     \"recommendations\": Array [\u001b[39m\n    \u001b[31m+       \"Use high-resolution images for better AI analysis\",\u001b[39m\n    \u001b[31m+       \"Ensure design elements are clearly visible\",\u001b[39m\n    \u001b[31m+       \"PNG format recommended for designs with text\",\u001b[39m\n    \u001b[31m+       \"JPEG format recommended for photographs\",\u001b[39m\n    \u001b[2m      ],\u001b[22m\n    \u001b[2m      \"supportedTypes\": Array [\u001b[22m\n    \u001b[2m        Object {\u001b[22m\n    \u001b[32m-         \"description\": \"PNG images\",\u001b[39m\n    \u001b[32m-         \"extension\": \"png\",\u001b[39m\n    \u001b[32m-         \"mimeType\": \"image/png\",\u001b[39m\n    \u001b[32m-       },\u001b[39m\n    \u001b[32m-       Object {\u001b[39m\n    \u001b[2m          \"description\": \"JPEG images\",\u001b[22m\n    \u001b[32m-         \"extension\": \"jpg\",\u001b[39m\n    \u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n    \u001b[31m+         \"extensions\": Array [\u001b[39m\n    \u001b[31m+           \".jpg\",\u001b[39m\n    \u001b[31m+           \".jpeg\",\u001b[39m\n    \u001b[31m+         ],\u001b[39m\n    \u001b[31m+         \"type\": \"image/jpeg\",\u001b[39m\n    \u001b[2m        },\u001b[22m\n    \u001b[2m        Object {\u001b[22m\n    \u001b[32m-         \"description\": \"JPEG images\",\u001b[39m\n    \u001b[32m-         \"extension\": \"jpeg\",\u001b[39m\n    \u001b[32m-         \"mimeType\": \"image/jpeg\",\u001b[39m\n    \u001b[31m+         \"description\": \"PNG images\",\u001b[39m\n    \u001b[31m+         \"extensions\": Array [\u001b[39m\n    \u001b[31m+           \".png\",\u001b[39m\n    \u001b[31m+         ],\u001b[39m\n    \u001b[31m+         \"type\": \"image/png\",\u001b[39m\n    \u001b[2m        },\u001b[22m\n    \u001b[2m        Object {\u001b[22m\n    \u001b[2m          \"description\": \"GIF images\",\u001b[22m\n    \u001b[32m-         \"extension\": \"gif\",\u001b[39m\n    \u001b[32m-         \"mimeType\": \"image/gif\",\u001b[39m\n    \u001b[31m+         \"extensions\": Array [\u001b[39m\n    \u001b[31m+           \".gif\",\u001b[39m\n    \u001b[31m+         ],\u001b[39m\n    \u001b[31m+         \"type\": \"image/gif\",\u001b[39m\n    \u001b[2m        },\u001b[22m\n    \u001b[2m        Object {\u001b[22m\n    \u001b[2m          \"description\": \"WebP images\",\u001b[22m\n    \u001b[32m-         \"extension\": \"webp\",\u001b[39m\n    \u001b[32m-         \"mimeType\": \"image/webp\",\u001b[39m\n    \u001b[31m+         \"extensions\": Array [\u001b[39m\n    \u001b[31m+           \".webp\",\u001b[39m\n    \u001b[31m+         ],\u001b[39m\n    \u001b[31m+         \"type\": \"image/webp\",\u001b[39m\n    \u001b[2m        },\u001b[22m\n    \u001b[2m      ],\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[32m-   \"message\": \"Supported file types retrieved successfully\",\u001b[39m\n    \u001b[2m    \"success\": true,\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 87 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 88 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 89 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody)\u001b[33m.\u001b[39mtoEqual({\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 90 |\u001b[39m         success\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 91 |\u001b[39m         data\u001b[33m:\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 92 |\u001b[39m           supportedTypes\u001b[33m:\u001b[39m [\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:89:29)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/upload › should successfully upload and convert a PNG image\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 120 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 121 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m mockImageBuffer\u001b[33m,\u001b[39m \u001b[32m'test-design.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 122 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 123 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 124 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 125 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'fileName'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'test-design.png'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:122:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/upload › should successfully upload and convert a JPG image\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 133 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 134 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m mockImageBuffer\u001b[33m,\u001b[39m \u001b[32m'test-design.jpg'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 135 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 136 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 137 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 138 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39mfileName)\u001b[33m.\u001b[39mtoBe(\u001b[32m'test-design.jpg'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:135:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/upload › should reject files that are too large\u001b[39m\u001b[22m\n\n    expected 413 \"Payload Too Large\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 155 |\u001b[39m         \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 156 |\u001b[39m         \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m largeBuffer\u001b[33m,\u001b[39m \u001b[32m'large-image.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 157 |\u001b[39m         \u001b[33m.\u001b[39mexpect(\u001b[35m413\u001b[39m)\u001b[33m;\u001b[39m \u001b[90m// Payload too large\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 158 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 159 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 160 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:157:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/upload › should handle OpenAI service errors\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\n    Expected substring: \u001b[32m\"OpenAI API error\"\u001b[39m\n    Received string:    \u001b[31m\"Input buffer contains unsupported image format\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 180 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 181 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 182 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoContain(\u001b[32m'OpenAI API error'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                   \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 183 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 184 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 185 |\u001b[39m     it(\u001b[32m'should reject PDF files with appropriate message'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:182:35)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/refine › should successfully refine HTML code\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m, \u001b[22m\u001b[32mvalue\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected path: \u001b[32m\"refinedHTML\"\u001b[39m\n\n    Expected value: \u001b[32m\"<div class=\\\"\u001b[7mbg-gradient-to-r from-blue-500 to-purple-600\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m5\u001b[27mxl font-bold text-\u001b[7mwhite\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mblue-1\u001b[27m00 mt-4\\\">This is \u001b[7ma \u001b[27mrefined \u001b[7mdesign with better styling\u001b[27m.</p></div>\"\u001b[39m\n    Received value: \u001b[31m\"<div class=\\\"\u001b[7mrefined bg-white\u001b[27m p-8\\\"><h1 class=\\\"text-\u001b[7m4\u001b[27mxl font-bold text-\u001b[7mgray-900\u001b[27m\\\">Welcome</h1><p class=\\\"text-\u001b[7mgray-6\u001b[27m00 mt-4\\\">This is refined \u001b[7mHTML\u001b[27m.</p></div>\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 212 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 213 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'originalHTML'\u001b[39m\u001b[33m,\u001b[39m htmlCode)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 214 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'refinedHTML'\u001b[39m\u001b[33m,\u001b[39m mockRefinedHTML)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 215 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'requirements'\u001b[39m\u001b[33m,\u001b[39m requirements)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 216 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mmessage)\u001b[33m.\u001b[39mtoBe(\u001b[32m'HTML successfully refined'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 217 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:214:34)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mDesign Controller API Tests › POST /api/design/refine › should reject empty HTML input\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoContain\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // indexOf\u001b[22m\n\n    Expected substring: \u001b[32m\"HTML code is required\"\u001b[39m\n    Received string:    \u001b[31m\"Invalid request data\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 236 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 237 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 238 |\u001b[39m       expect(response\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoContain(\u001b[32m'HTML code is required'\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                   \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 239 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 240 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 241 |\u001b[39m     it(\u001b[32m'should reject missing HTML input'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:238:35)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mIntegration Tests › should handle complete workflow: upload -> refine\u001b[39m\u001b[22m\n\n    expected 200 \"OK\", got 500 \"Internal Server Error\"\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 278 |\u001b[39m       \u001b[33m.\u001b[39mpost(\u001b[32m'/api/design/upload'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 279 |\u001b[39m       \u001b[33m.\u001b[39mattach(\u001b[32m'design'\u001b[39m\u001b[33m,\u001b[39m mockImageBuffer\u001b[33m,\u001b[39m \u001b[32m'test-design.png'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 280 |\u001b[39m       \u001b[33m.\u001b[39mexpect(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 281 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 282 |\u001b[39m     expect(uploadResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 283 |\u001b[39m     \u001b[36mconst\u001b[39m generatedHTML \u001b[33m=\u001b[39m uploadResponse\u001b[33m.\u001b[39mbody\u001b[33m.\u001b[39mdata\u001b[33m.\u001b[39manalysis\u001b[33m.\u001b[39mhtml\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36msrc/__tests__/designController.test.ts\u001b[39m\u001b[0m\u001b[2m:280:8)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      ----\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertStatus (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:309:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:365:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test._assertFunction (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:342:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Test.assert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:195:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat localAssert (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:138:14)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Server.<anonymous> (\u001b[22m\u001b[2mnode_modules/supertest/lib/test.js\u001b[2m:152:11)\u001b[22m\u001b[2m\u001b[22m\n","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/designController.test.ts","startTime":1753706859354,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Comprehensive E2E Test Suite","1. Input Processing Pipeline"],"duration":138,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 1. Input Processing Pipeline HTML Input Processing","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"HTML Input Processing"},{"ancestorTitles":["Comprehensive E2E Test Suite","1. Input Processing Pipeline"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 1. Input Processing Pipeline Complex Layout Splitting","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Complex Layout Splitting"},{"ancestorTitles":["Comprehensive E2E Test Suite","1. Input Processing Pipeline"],"duration":26,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 1. Input Processing Pipeline Field Mapping Accuracy","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"Field Mapping Accuracy"},{"ancestorTitles":["Comprehensive E2E Test Suite","2. AI Processing Pipeline"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 2. AI Processing Pipeline Module Generation from Sections","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Module Generation from Sections"},{"ancestorTitles":["Comprehensive E2E Test Suite","2. AI Processing Pipeline"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 2. AI Processing Pipeline Sequential Processing Quality","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Sequential Processing Quality"},{"ancestorTitles":["Comprehensive E2E Test Suite","3. Validation Pipeline"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 3. Validation Pipeline Module Validation - Valid Module","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Module Validation - Valid Module"},{"ancestorTitles":["Comprehensive E2E Test Suite","3. Validation Pipeline"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 3. Validation Pipeline Module Validation - Invalid Module","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"Module Validation - Invalid Module"},{"ancestorTitles":["Comprehensive E2E Test Suite","3. Validation Pipeline"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 3. Validation Pipeline Batch Validation","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"Batch Validation"},{"ancestorTitles":["Comprehensive E2E Test Suite","4. Export and Packaging"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 4. Export and Packaging Module Export Generation","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Module Export Generation"},{"ancestorTitles":["Comprehensive E2E Test Suite","4. Export and Packaging"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 4. Export and Packaging Batch Export Processing","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Batch Export Processing"},{"ancestorTitles":["Comprehensive E2E Test Suite","5. Integration and Performance"],"duration":42,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 5. Integration and Performance Schema Compatibility Check","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"Schema Compatibility Check"},{"ancestorTitles":["Comprehensive E2E Test Suite","5. Integration and Performance"],"duration":131,"failureDetails":[],"failureMessages":[],"fullName":"Comprehensive E2E Test Suite 5. Integration and Performance End-to-End Processing Performance","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"End-to-End Processing Performance"}],"endTime":1753706864967,"message":"","name":"/Users/timratig/CascadeProjects/templator/backend/src/__tests__/comprehensive-e2e.test.ts","startTime":1753706859354,"status":"passed","summary":""}],"wasInterrupted":false}
